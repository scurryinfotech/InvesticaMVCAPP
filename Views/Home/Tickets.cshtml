@{
    ViewData["Title"] = "Tickets";
    Layout = "~/Views/Shared/_Layout.cshtml";
}

<div class="container-custom" id ="ticketCard">
    @Html.Partial("~/Views/Shared/_leftPanel.cshtml")

    <div class="right-panel">
        <div class="dashboard" id="dashboard">
            <!-- Ticket Card 1 -->
            <div class="card p-4">
                <div class="container-fluid">
                    <div class="row g-3">

                        <!-- Left column -->
                        <div class="col-md-3 d-flex flex-column">
                            <div>
                                <div id="t1_status" class="rounded border p-2 text-center fw-bold mb-3">STATUS</div>
                                <div id="t1_license" class="rounded border p-2 text-center fw-bold mb-3">License Type</div>
                                <div id="t1_tracking" class="rounded border p-2 text-center fw-bold mb-3">Tracking No</div>
                            </div>

                            <div class="mt-auto d-flex gap-2">
                                <button class="btn btn-outline-dark btn-sm rounded-pill">More</button>
                                <button class="btn btn-outline-dark btn-sm rounded-pill edit-btn" data-card="t1">Edit</button>
                                <button class="btn btn-outline-dark btn-sm rounded-pill attach-btn" data-card="t1">Attachments</button>
                            </div>
                        </div>

                        <!-- Middle column -->
                        <div class="col-md-5">
                            <div id="t1_company" class="rounded border p-2 text-center fw-bold mb-3">Company Name</div>
                            <div id="t1_address" class="rounded border p-3 fw-bold mb-3">Address of company/stores</div>

                            <label class="fw-bold mb-2" style="font-size:0.9em;">Add Note</label>
                            <textarea id="t1_noteInput" class="form-control mb-2" rows="2" placeholder="Enter your note here..."></textarea>
                            <button class="btn btn-sm btn-primary w-100 mb-2 note-btn" data-card="t1"
                                    style="background:#0f1445;border:none;">
                                Add Note
                            </button>

                            <div id="t1_notes" class="rounded border p-2 bg-light" style="max-height:120px; overflow-y:auto;">
                                <small style="color:#666;">Notes will appear here</small>
                            </div>
                        </div>

                        <!-- Right column -->
                        <div class="col-md-4 d-flex flex-column">
                            <div id="t1_employee" class="rounded border p-2 text-center fw-bold mb-3">Employee Name - Date</div>
                            <div id="t1_validity" class="rounded border p-2 text-center fw-bold mb-3">Date of Validity</div>
                            <div id="t1_desc" class="rounded border p-3 fw-bold bg-light"
                                 style="flex:1; min-height:245px; white-space:pre-line; overflow-y:auto;">
                                Description
                            </div>
                        </div>

                    </div>
                </div>
            </div>

            <!-- Ticket Card 2 -->
            <div class="card p-4">
                <div class="container-fluid">
                    <div class="row g-3">

                        <div class="col-md-3 d-flex flex-column">
                            <div>
                                <div id="t2_status" class="rounded border p-2 text-center fw-bold mb-3">STATUS</div>
                                <div id="t2_license" class="rounded border p-2 text-center fw-bold mb-3">License Type</div>
                                <div id="t2_tracking" class="rounded border p-2 text-center fw-bold mb-3">Tracking No</div>
                            </div>

                            <div class="mt-auto d-flex gap-2">
                                <button class="btn btn-outline-dark btn-sm rounded-pill">More</button>
                                <button class="btn btn-outline-dark btn-sm rounded-pill edit-btn" data-card="t2">Edit</button>
                                <button class="btn btn-outline-dark btn-sm rounded-pill attach-btn" data-card="t2">Attachments</button>
                            </div>
                        </div>

                        <div class="col-md-5">
                            <div id="t2_company" class="rounded border p-2 text-center fw-bold mb-3">Company Name</div>
                            <div id="t2_address" class="rounded border p-3 fw-bold mb-3">Address of company/stores</div>

                            <label class="fw-bold mb-2" style="font-size:0.9em;">Add Note</label>
                            <textarea id="t2_noteInput" class="form-control mb-2" rows="2" placeholder="Enter your note here..."></textarea>
                            <button class="btn btn-sm btn-primary w-100 mb-2 note-btn" data-card="t2"
                                    style="background:#0f1445;border:none;">
                                Add Note
                            </button>

                            <div id="t2_notes" class="rounded border p-2 bg-light" style="max-height:120px; overflow-y:auto;">
                                <small style="color:#666;">Notes will appear here</small>
                            </div>
                        </div>

                        <div class="col-md-4 d-flex flex-column">
                            <div id="t2_employee" class="rounded border p-2 text-center fw-bold mb-3">Employee Name - Date</div>
                            <div id="t2_validity" class="rounded border p-2 text-center fw-bold mb-3">Date of Validity</div>
                            <div id="t2_desc" class="rounded border p-3 fw-bold bg-light"
                                 style="flex:1; min-height:245px; white-space:pre-line; overflow-y:auto;">
                            </div>
                        </div>

                    </div>
                </div>
            </div>

            <!-- Ticket Card 3 -->
            <div class="card p-4">
                <div class="container-fluid">
                    <div class="row g-3">

                        <div class="col-md-3 d-flex flex-column">
                            <div>
                                <div id="t3_status" class="rounded border p-2 text-center fw-bold mb-3">STATUS</div>
                                <div id="t3_license" class="rounded border p-2 text-center fw-bold mb-3">License Type</div>
                                <div id="t3_tracking" class="rounded border p-2 text-center fw-bold mb-3">Tracking No</div>
                            </div>

                            <div class="mt-auto d-flex gap-2">
                                <button class="btn btn-outline-dark btn-sm rounded-pill">More</button>
                                <button class="btn btn-outline-dark btn-sm rounded-pill edit-btn" data-card="t3">Edit</button>
                                <button class="btn btn-outline-dark btn-sm rounded-pill attach-btn" data-card="t3">Attachments</button>
                            </div>
                        </div>

                        <div class="col-md-5">
                            <div id="t3_company" class="rounded border p-2 text-center fw-bold mb-3">Company Name</div>
                            <div id="t3_address" class="rounded border p-3 fw-bold mb-3">Address of company/stores</div>

                            <label class="fw-bold mb-2" style="font-size:0.9em;">Add Note</label>
                            <textarea id="t3_noteInput" class="form-control mb-2" rows="2" placeholder="Enter your note here..."></textarea>
                            <button class="btn btn-sm btn-primary w-100 mb-2 note-btn" data-card="t3"
                                    style="background:#0f1445;border:none;">
                                Add Note
                            </button>

                            <div id="t3_notes" class="rounded border p-2 bg-light" style="max-height:120px; overflow-y:auto;">
                                <small style="color:#666;">Notes will appear here</small>
                            </div>
                        </div>

                        <div class="col-md-4 d-flex flex-column">
                            <div id="t3_employee" class="rounded border p-2 text-center fw-bold mb-3">Employee Name - Date</div>
                            <div id="t3_validity" class="rounded border p-2 text-center fw-bold mb-3">Date of Validity</div>
                            <div id="t3_desc" class="rounded border p-3 fw-bold bg-light"
                                 style="flex:1; min-height:245px; white-space:pre-line; overflow-y:auto;">
                                Description
                            </div>
                        </div>

                    </div>
                </div>
            </div>

        </div>
    </div>
</div>

<!-- Attachments Modal -->
<div class="modal fade" id="attachmentsModal" tabindex="-1" aria-hidden="true">
    <div class="modal-dialog modal-lg">
        <div class="modal-content">

            <!-- HEADER -->
            <div class="modal-header" style="background:#0f1445; color:#fff;">
                <h5 class="modal-title">Attachments</h5>
                <button type="button" class="btn-close btn-close-white" data-bs-dismiss="modal"></button>
            </div>

            <!-- BODY -->
            <div class="modal-body">

                <!-- file input + Upload button (already wired in your JS) -->
                <div class="mb-3">
                    <label class="fw-bold mb-1" style="font-size:0.9em;">Add Attachments</label>
                    <div class="input-group">
                        <input type="file" id="attachmentFileInput" class="form-control" multiple>
                        <button class="btn btn-primary" id="uploadAttachmentBtn" style="background:#0f1445; border:none;">
                            Upload
                        </button>
                    </div>
                </div>

                <!-- progress bar (hidden by default, shown during upload) -->
                <div id="uploadProgress" class="mb-3" style="display:none;">
                    <div class="progress" style="height:18px;">
                        <div class="progress-bar bg-success" id="uploadProgressBar" role="progressbar" style="width:0%;">0%</div>
                    </div>
                </div>

                <hr>
                <!-- PREVIEW BOX — add this above attachmentsList -->
                <div id="attachmentPreview" style="display:none; margin-bottom:12px; border:1px solid #dee2e6; border-radius:8px; overflow:hidden;">
                    <div class="d-flex justify-content-between align-items-center px-2 py-1" style="background:#f8f9fa; border-bottom:1px solid #dee2e6;">
                        <small class="fw-bold" id="previewFileName">filename</small>
                        <button class="btn btn-sm btn-link text-danger p-0" id="closePreviewBtn"><i class="bi bi-x-lg"></i></button>
                    </div>
                    <div id="previewContent" style="width:100%; height:350px;"></div>
                </div>

                <hr>
                <!-- list filled by renderList() -->
                <ul class="list-group" id="attachmentsList">
                    <li class="list-group-item text-muted text-center py-3">
                        <i class="bi bi-paperclip me-1"></i>No attachments
                    </li>
                </ul>
            </div>

            <!-- FOOTER — Clear + Close -->
            <div class="modal-footer">
                <button type="button" class="btn btn-outline-secondary btn-sm rounded-pill" id="clearAttachmentBtn">
                    <i class="bi bi-x-circle me-1"></i>Clear
                </button>
                <button type="button" class="btn btn-secondary btn-sm rounded-pill" data-bs-dismiss="modal">
                    Close
                </button>
            </div>

        </div>
    </div>
</div>

<div id="downloadLoader" style="
    display:none;
    position:fixed;
    top:0; left:0; right:0; bottom:0;
    background:rgba(0,0,0,0.3);
    z-index:9999;
    text-align:center;
    padding-top:200px;
    font-size:20px;
    color:white;
">
    Downloading...
</div>

@section Scripts {
    <script src="~/js/Tickets.js"></script>

    <script src="~/js/LeftPanel.js"></script>
}
